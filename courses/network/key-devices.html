<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#5397d2"><script>
      var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e772d8d7735057378a672ae311e9bf20";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
    </script><title>网络中的关键设备 | 众里千寻</title><meta name="description" content="对互联网中各种关键设备进行功能说明"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.22">
    <link rel="preload" href="/assets/js/runtime~app.fa50ff6a.js" as="script"><link rel="preload" href="/assets/css/styles.e0095a00.css" as="style"><link rel="preload" href="/assets/js/3767.b5b9e7ce.js" as="script"><link rel="preload" href="/assets/js/app.8de2a662.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.e0095a00.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><span><a href="/" class=""><img class="logo" src="/hero-c.png" alt="众里千寻"><span class="site-name can-hide">众里千寻</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/courses/" class="nav-link router-link-active" aria-label="学习笔记"><!--[--><!--]--> 学习笔记 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/solutions/" class="nav-link" aria-label="解决方案"><!--[--><!--]--> 解决方案 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/tools/" class="nav-link" aria-label="开发利器"><!--[--><!--]--> 开发利器 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/code-reading/" class="nav-link" aria-label="源码解读"><!--[--><!--]--> 源码解读 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/posts/" class="nav-link" aria-label="最新消息"><!--[--><!--]--> 最新消息 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/everfind" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/courses/" class="nav-link router-link-active" aria-label="学习笔记"><!--[--><!--]--> 学习笔记 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/solutions/" class="nav-link" aria-label="解决方案"><!--[--><!--]--> 解决方案 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/tools/" class="nav-link" aria-label="开发利器"><!--[--><!--]--> 开发利器 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/code-reading/" class="nav-link" aria-label="源码解读"><!--[--><!--]--> 源码解读 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/posts/" class="nav-link" aria-label="最新消息"><!--[--><!--]--> 最新消息 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/everfind" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">网络中的关键设备</p><ul class=""><li><!--[--><a aria-current="page" href="/courses/network/key-devices.html#主机-host" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="主机（host）"><!--[--><!--]--> 主机（host） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/courses/network/key-devices.html#网络-network" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="网络（network）"><!--[--><!--]--> 网络（network） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/courses/network/key-devices.html#交换机-switch" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="交换机（switch）"><!--[--><!--]--> 交换机（switch） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/courses/network/key-devices.html#路由器-router" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="路由器（router）"><!--[--><!--]--> 路由器（router） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/courses/network/key-devices.html#地址解析协议-address-resolution-protocol-arp" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="地址解析协议（Address Resolution Protocol，ARP）"><!--[--><!--]--> 地址解析协议（Address Resolution Protocol，ARP） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/courses/network/key-devices.html#总结" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><p>互联网是由无数个小网络组成的，在这些网络中有各种各样的设备。今天我们来说一说实现网络通信的几个关键设备，以及这些设备是如何实现其功能的。</p><h2 id="主机-host" tabindex="-1"><a class="header-anchor" href="#主机-host" aria-hidden="true">#</a> 主机（host）</h2><p>主机范指互联网上的任何一个端点设备，这个设备可以是发起数据传输的起点，也可以是接受数据的终点。</p><p>最经典的例子就是我们的电脑。</p><p><img src="/courses/network/host-c.png" alt="主机"></p><p>主机运行应用程序来与最终用户交互，同时，主机也会将数据写入网络进行传输。因此，主机可以操作所有的七层 OSI 模型。</p><p>典型的网络传输中，通信双方通常被成为客户端和服务端。客户端发起请求，服务端处理请求并返回客户端需要的数据。</p><h2 id="网络-network" tabindex="-1"><a class="header-anchor" href="#网络-network" aria-hidden="true">#</a> 网络（network）</h2><p>一个网络一般有至少两个主机组成。一个网络有多重存在形式：</p><ul><li>教室中的一组 PC，在同一地点组成一个网络。</li><li>在家庭网络中，有多重类型的设备，手机、电脑、打印机等，这些设备组成家庭网络。</li><li>在一家咖啡店里，WIFI 网络中有很多连接到这个 WIFI 的移动设备。</li><li>一家公司通常有多个网络，比如供开发人员使用的开发网络，供全员使用的办公网络等。</li></ul><p>每种网络的功能不同，网络中的设备彼此连接通信，同时这些设备还可以与网络外的其他设备通信。实际上，这个互联网是由若干个互相连接的网络组成的。</p><h2 id="交换机-switch" tabindex="-1"><a class="header-anchor" href="#交换机-switch" aria-hidden="true">#</a> 交换机（switch）</h2><p>交换机是一个网络内的设备，负责网络内的数据通信。</p><p>交换机工作在 OSI 模型中的第二层，也就是说交换机只处理数据帧中第二层的数据头。第二层的数据头中包含两<a href="/courses/network/osi-model.html#%E7%AC%AC%E4%BA%8C%E5%B1%82-%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82" class="">跳</a>的地址信息（源和目标的 MAC 地址）。</p><p><img src="/courses/network/switch-c.png" alt="交换机"></p><p>在交换机中维护这一个 MAC 地址表。这个地址表记录着每一个插在交换机端口上的设备的 MAC 地址。一个交换机有多个端口，从 24 个到 48 个，到 96 个，甚至更多。</p><p>交换机通过读取接受到的数据的来源 MAC 地址来扩展 MAC 地址表。同时，交换机会根据目标 MAC 地址和 MAC 地址表来确定使用哪个端口。</p><p>如果交换机无法确定使用哪个端口，则会将这条数据逐端口转发（排除接收数据的端口）。</p><h2 id="路由器-router" tabindex="-1"><a class="header-anchor" href="#路由器-router" aria-hidden="true">#</a> 路由器（router）</h2><p>路由器是一个网络间的设备，负责网络间的通信。路由器上的每一个接口都会创建一个网络边界。</p><p>路由器工作在 OSI 模型中的第三层，也就是说路由器只处理数据帧中第三层的数据头。第三层的数据头中包含端到端的地址信息（比如源和目标的 IP 地址）。</p><p><img src="/courses/network/router-device-c.png" alt="路由器"></p><p>上图左侧的路由器（R1）和右侧的路由器（R2）创建了三个隔离的网络（(11.11.11.x，22.22.22.x 和 33.33.33.x)），R1 的右侧接口和 R2 的左侧接口处在同一个网络中。</p><p>网络 11.11.11.x 中的主机要想与网络 33.33.33.x 中的主机进行通信，就必须将数据发送给路由器 R1，然后在发送给路由器 R2，最后在由路由器 R2 发送给网络 33.33.33.x 中的主机。</p><p>路由器通过路由表（Routing Table）来实现上述功能。这个表中记录了去向所有路由器知道的网络的路径。这些记录通常被称为路由。表中的每一条记录包含一个 IP 网络和能够到达该网络的下一个路由器的地址。</p><p>注意，对于路由器来说，路由表记录了所有它知道的网络。如果路由器接收到一个发往它不知道的网络的数据包，那么就该路由器而言，该网络一定不存在。因此，如果一个数据包的目标网络不在路由器的路由表中，该数据包会被路由器抛弃。</p><h2 id="地址解析协议-address-resolution-protocol-arp" tabindex="-1"><a class="header-anchor" href="#地址解析协议-address-resolution-protocol-arp" aria-hidden="true">#</a> 地址解析协议（Address Resolution Protocol，ARP）</h2><p>前面我们讨论过第二层的 MAC 地址，以及第三层的 IP 地址。地址解析协议将这两个地址联接起来。</p><p>一般来说，两个主机在进行通信之前，是知道对方的 IP 地址的。获取这个 IP 地址的方式有很多种，比如别人已经给定地址，或者通过 DNS 获取。</p><p>知道了 IP 地址，但是却无法知道对方的 MAC 地址。主机会通过 ARP 协议来确定对方的 MAC 地址。换句话说，ARP 协议使用 IP 地址来确定 MAC 地址。建立联系的 IP 地址和 MAC 地址被存放在 ARP 表中。</p><p><img src="/courses/network/arp-c.png" alt="ARP"></p><p>在上图中，有三个网络。首先，如果紫色网络内的主机要与紫色网络内的其他主机通信，通过 IP 地址可以判断出目标主机在同一个网络内。源主机通过 ARP 协议可以确定目标主机的 MAC 地址，从而可以设置第二层数据头如下：</p><p><img src="/courses/network/inner-network-arp-c.png" alt="网络内的 ARP"></p><p>当紫色网路中的主机要与右边红色网络中的主机进行通信时，通过 IP 地址就可以判断出目标主机处在紫色网络外。这时，紫色网络中的主机就知道需要将数据包发给路由器 R1。如果主机确定目标主机是网络外的设备，那么它就会通过 ARP 协议获取最近的路由器的 MAC 地址。</p><p><img src="/courses/network/outer-network-arp-c.png" alt="网络外的 ARP"></p><p>总结一下 ARP：</p><ul><li>如果目标主机处在网络内，那么源主机就通过 ARP 确定目标主机的 MAC 地址。</li><li>如果目标主机处在网络外，那么源主机就通过 ARP 确定最近的路由器的 MAC 地址。</li></ul><p>我们知道，第二层负责逐跳传输数据包，第三层则负责端到端的传输数据包。ARP 就是帮助第三层来确定正确的第二层数据头来完成数据传输。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>本篇和<a href="./osi-model">前面的一篇</a> 介绍了网络中的种种概念，这些是计算机网络中的基础。</p><p>首先我们介绍了 OSI 模型中各层的职能。</p><ul><li>第一层负责在物理媒介中传输 0/1 数据流。</li><li>第二层使用 MAC 地址来实现逐跳的数据传输。</li><li>第三层使用 IP 地址来实现端到端的数据传输。</li><li>第四层通过端口号来实现应用服务到应用服务的数据传输。</li></ul><p>我们还讨论了网络中的设备。</p><ul><li>交换机负责网络内的通信，工作在第二层。</li><li>路由器负责网络间的通信，工作在第三层。</li><li>ARP 通过已知的 IP 地址来确定的未知的 MAC 地址。</li></ul><p>在各个设备中，使用了不同的映射表。</p><ul><li>交换机使用 MAC 地址表，来确定交换机的端口和 MAC 地址的映射关系。</li><li>路由器使用路由表，来确定网络和能到这个网路的下一个路由器的地址。</li><li>所有的第三层设备都使用 ARP 表来确定 IP 地址的 MAC 地址。</li></ul><div style="display:flex;align-items:center;justify-content:center;"><p style="text-align:center;margin-top:10px;color:#999;"><img src="/qrcode-c.jpg" style="width:200px;height:200px;display:block;margin:10px auto;opacity:0.8;">关注微信公众号，获取最新推送~</p><p style="text-align:center;margin-top:10px;color:#999;"><img src="/card-c.jpeg" style="width:200px;height:200px;display:block;margin:10px auto;opacity:0.8;">加微信，深入交流~</p></div><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main></div><!----><!----><!--]--></div>
    <script src="/assets/js/runtime~app.fa50ff6a.js" defer></script><script src="/assets/js/3767.b5b9e7ce.js" defer></script><script src="/assets/js/app.8de2a662.js" defer></script>
  </body>
</html>
